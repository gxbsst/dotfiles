#source /Users/weston/Library/Python/3.8/lib/python/site-packages/powerline/bindings/tmux/powerline.conf

# Install tpm + plugins with:
# git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
# trigger plugin install with: prefix + I
# trigger plugin update with: prefix + U
# set -g @extrakto_split_size '15'

# Change prefix key to Ctrl+a
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# force a reload of the config file
unbind r
bind r source-file ~/.tmux.conf \; display-message 'Configuration reloaded.'

# This is needed for tmux > 1.8
# http://unix.stackexchange.com/a/109255/66916
bind c new-window -c "#{pane_current_path}"
#bind % split-window -h -c "#{pane_current_path}"
#bind '"' split-window -c "#{pane_current_path}"

unbind %
bind | split-window -h 

unbind '"'
bind - split-window -v

bind -r j resize-pane -D 5
bind -r k resize-pane -U 5
bind -r l resize-pane -R 5
bind -r h resize-pane -L 5

#bind -r j previous-window
#bind -r k next-window
bind -n S-Left  previous-window
bind -n S-Right next-window

bind -r m resize-pane -Z


# Last active window
# unbind l
# bind C-a last-window

# use vi mode
set-window-option -g mode-keys vi

# Bigger history
set -g history-limit 50000

# Terminal emulator window title
set -g set-titles on
set -g set-titles-string '#S:#I.#P #W'

# right status bar
set -g status-interval 10
battery_info="#[fg=green]battery ‚ô• #(~/.tmux/battery.sh)"
date_time="#[fg=yellow]%a %d %b %Y #[fg=green]:: %l:%M %p "
# set -g status-right "$battery_info | $date_time"
#set-option -g status-right "#{pane_title} "

# thanks to:
# https://github.com/skwp/dotfiles/blob/master/tmux/tmux.conf
# https://gist.github.com/alexyoung/6040385
# color scheme (styled as vim-powerline)
#set -g status-left-length 120
# set -g status-right-length 120 
set -g status-fg white
set -g status-bg colour232
#set -g pane-border-fg colour245
#set -g pane-active-border-fg colour39
#set -g message-fg colour16
#set -g message-bg colour221
#set -g message-attr bold
# set -g status-left '#[fg=colour235,bg=colour252,bold] #S #[fg=colour252,bg=colour238,nobold]#[fg=colour245,bg=colour238,bold] #(hostname) #[fg=colour238,bg=colour234,nobold]'
set -g status-left '#[fg=colour235,bg=colour252,bold] #S #[fg=colour252,bg=colour238,nobold]#[fg=colour245,bg=colour238,bold] #(whoami) #[fg=colour238,bg=colour234,nobold]'
set -g window-status-format "#[fg=colour10,bg=colour234] #I #[fg=colour231,bold]#W#F #[fg=colour31,bg=colour234,nobold]"
set -g window-status-current-format "#[fg=colour10,bg=colour31] #I #[fg=colour231,bold]#W  #[fg=colour31,bg=colour234,nobold]"
# ^ tip, to list colors use this in bash:
#   for i in {0..255}; do printf "\x1b[38;5;${i}mcolour${i} "; done; echo

# Notifying if other windows has activities
# setw -g monitor-activity on
# set -g visual-activity on

# Highlight the active window in status bar
#setw -g window-status-current-bg blue

# Clock
# setw -g clock-mode-colour green
setw -g clock-mode-style 24

# color settings
# some times you need to use: `alias tmux="tmux -2"`
# set -g default-terminal "xterm-256color"
# set -g default-terminal "screen-256color"
# to be friendly with vim: get shift, alt, ctrl keys working
set-option -g xterm-keys on

# to avoid esc delay in vim
set -s escape-time 0

# display the messages in the status bar a little longer than the default
# set-option -g display-time 4000

# enable for remote hosts:
# set -g update-environment "DISPLAY SSH_ASKPASS SSH_AGENT_PID SSH_CONNECTION WINDOWID XAUTHORITY"
# set-environment -g 'SSH_AUTH_SOCK' ~/.ssh/ssh_auth_sock

# This was needed for clipboard to work on OSX Sierra, it seems that is not needed now
# set -g default-shell $SHELL
# set -g default-command "reattach-to-user-namespace -l ${SHELL}"

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)

set -g mouse on


# Fig Tmux Integration: Enabled
# source-file ~/.fig/tmux
# End of Fig Tmux Integration

## Use vim keybindings in copy mode
set-option -g mouse on
# setw -g mode-keys vi
set-option -s set-clipboard off
bind P paste-buffer
#bind-key -T copy-mode-vi v send-keys -X begin-selection
#bind-key -T copy-mode-vi y send-keys -X rectangle-toggle
# unbind -T copy-mode-vi Enter
# bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel 'xclip -se c -i'
# bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel 'xclip -se c -i'

set-window-option -g mode-keys vi

bind-key -T copy-mode-vi 'v' send -X begin-selection # start selecting text with "v"
bind-key -T copy-mode-vi 'y' send -X copy-selection # copy text with "y"

unbind -T copy-mode-vi MouseDragEnd1Pane # don't exit copy mode when dragging with mouse
# Switch between two most recently used sessions
bind ^ switch-client -l

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'laktak/extrakto'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'jimeh/tmux-themepack'
set -g @plugin 'tmux-plugins/tmux-continuum' # automatically saves sessions for you every 15 minutes
set -g @plugin 'samoshkin/tmux-plugin-sysstat'
set -g @plugin 'fcsonline/tmux-thumbs'


# set -g @themepack 'powerline/double/magenta'
 # set -g @themepack 'powerline/double/cyan'
 # set -g @themepack 'powerline/default/gray'
# set -g @themepack 'powerline/default/gray'
# set -g @themepack 'powerline/block/blue'
# set -g @themepack 'powerline/default/cyan'
set -g @themepack 'powerline/block/gray'

set -g @resurrect-capture-pane-contents 'on'
# set -g @continuum-restore 'on'

#localdate=$(date +"%Y-%m-%d")
#localtime=$(date +"%H:%M")


set -g @sysstat_cpu_view_tmpl '#{cpu.pused}'
set -g @sysstat_mem_view_tmpl '#{mem.pused}'

#set -g @themepack-status-right-area-left-format "#[fg=green]#(top -l 3 | awk '/CPU usage/ {print $3}')"
set -g @themepack-status-right-area-left-format "#[fg=green]#(top -l 3 | awk '/CPU usage/ {print $3}')|#{sysstat_mem}|#{sysstat_swap}#[bg=#222222]" 

set -g @themepack-status-right-area-middle-format 'üìÖ #(date +"%m-%d %H:%M")'
#set -g @themepack-status-right-area-middle-format "üë® WXH"
#set -g @themepack-status-right-area-middle-format ""
# set -g @themepack-status-right-area-right-format "#{pane_title}"
set -g @themepack-status-right-area-right-format "‚ôê #(cd #{pane_current_path}; git rev-parse --abbrev-ref HEAD)"

# set-option -g @themepack-status-position 'top'
# set-option -g status-position 'top'

# set -g @themepack-status-right "#{pane_title} "

# End of Fig Tmux Integration
run '~/.tmux/plugins/tpm/tpm'

# set-option -g status-position 'top'
# set -g status-right "#{pane_title} "

# toggle pane title visibility
# setw -g pane-border-format ' #{=/-20/‚Ä¶:pane_title} [#{=/-20/‚Ä¶:pane_current_command}] #(pgrep -P "#{pane_pid}" | tr "\n" " ")#{pane_current_path} #{?alternate_on,<Alt Mode> ,}'

bind T run 'zsh -c "arr=( off top ) && tmux setw pane-border-status \${arr[\$(( \${arr[(I)#{pane-border-status}]} % 2 + 1 ))]}"'
# rename pane
bind t command-prompt -p "(rename-pane)" -I "#T" "select-pane -T '%%'"

set -g status-justify left


set -g terminal-overrides ',xterm-256color:Tc'

set -g default-terminal "screen-256color"

set -as terminal-overrides ',xterm*:sitm=\E[3m'

set -g terminal-overrides 'xterm*:smcup@:rmcup@'

run-shell ~/.tmux/plugins/tmux-thumbs/tmux-thumbs.tmux

set -g @thumbs-key F

